/* Copyright (C) YOOtheme GmbH, http://www.gnu.org/licenses/gpl.html GNU/GPL */

(function(a,j){a(function(){a("main.tm-main > .tm-form").append('<div class="tm-form-save"><input type="submit" value="Save changes" class="uk-button uk-button-primary"/> <span></span></div>');var b=a('input:checkbox[name$="[title]"]');a.each(b,function(){a(this).after(a(this).clone().attr("type","hidden").val(a(this).is(":checked")?"1":"0"))});b.on("change",function(){a(this).next().val(a(this).is(":checked")?"1":"0")});a('[data-warp="theme"] input[type="submit"]').on("click",function(a){a.preventDefault();
e.save(this)})});var e={save:function(b){var c={},d=a(b);d.attr("disabled",!0).next().attr("class","uk-icon-spinner uk-icon-spin");parse_str(a(":input","#theme-options").serialize(),c);a.ajax({url:ajaxurl,type:"post",data:{action:"warp_save",config:JSON.stringify(c,null,"\t")},success:function(c){var b=!1;try{c=a.parseJSON(c),"success"==c.message&&(b=!0)}catch(h){}b||alert("Save failed!");setTimeout(function(){d.attr("disabled",!1).next().attr("class","")},300)}})},saveFiles:function(b){var c=a.Deferred(),
d=new FormData;d.append("action","warp_save_files");d.append("files",new Blob([JSON.stringify(b)],{type:"application/json"}));a.ajax({url:ajaxurl,type:"POST",data:d,processData:!1,contentType:!1}).always(function(b,d,h){var f=!1;if("error"==d)f=h;else try{b=a.parseJSON(b),"success"!=b.message&&(f=b.message)}catch(e){f="Saving failed!"}c[f?"reject":"resolve"](f)});return c.promise()},data:function(){var b=a.Deferred();a.ajax({url:ajaxurl,type:"post",data:{action:"warp_get_styles"}}).always(function(c,
d,e){var g=!1;if("error"==d)g=e;else try{if(c=a.parseJSON(c),"error"==c.message)g=c.message;else{b.resolve(c);return}}catch(h){g="Retrieving styles data failed!"}b.reject(g)});return b.promise()}};j.System=e})(jQuery,this);
